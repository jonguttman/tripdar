generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// Note: SQLite does not support enums. Enum validation is enforced in application logic.
// Valid values are documented here for reference:
//
// DoseCategory: MICRODOSE, LOW, MODERATE, HIGH
// ExperienceScale: MICRO, MACRO
// ReferenceFrame: BASELINE, WITHIN_STRAIN, CROSS_STRAIN
// Direction: MORE, LESS, SAME, NOT_NOTICED

model Signal {
  // Immutability intent:
  // - Signals are append-only.
  // - Signals MUST NOT be updated or deleted (enforce in application logic; not encoded as schema constraints here).
  // - Aggregation is computed from signals and MUST NOT be stored on this table.

  id String @id // Unique identifier (provided by application; no helper defaults)

  // Context
  strainId      String
  doseCategory  String  // MICRODOSE, LOW, MODERATE, HIGH (validated in app)
  scale         String  // MICRO, MACRO (validated in app)

  // Dimension (must be one of the 28 experiential dimensions; enforced in application logic)
  dimensionId String

  // Reference + conditional comparison fields (enforce conditional rules in application logic)
  referenceFrame     String   // BASELINE, WITHIN_STRAIN, CROSS_STRAIN (validated in app)
  comparisonDose     String?  // REQUIRED ONLY when referenceFrame = WITHIN_STRAIN; MUST be null otherwise
  comparisonStrainId String?  // REQUIRED ONLY when referenceFrame = CROSS_STRAIN; MUST be null otherwise

  // Observation
  direction String  // MORE, LESS, SAME, NOT_NOTICED (validated in app)

  // Grouping / anonymity
  sessionId String // Anonymous session identifier
  reportId  String // Groups signals from one submission

  // Creation timestamp (set by application at insert-time; no additional timestamps are stored)
  createdAt DateTime
}
